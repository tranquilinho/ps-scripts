#!/bin/bash

readonly service_cfg=${0%/scripts*}/etc/service.cfg

. ${service_cfg} && . ${scripts_base}/common

readonly pkg_name=nagios
readonly pkg_version=4.3.4
readonly url_base=https://assets.nagios.com/downloads/nagioscore/releases/

# log "${info} ${pkg_name} install started"

# nagios user is already needed for nagios-plugins and nrpe
${scripts_base}/nagios-user

install_prereq nagios-plugins "mandatory"
install_prereq nrpe "mandatory"
# !!!! php is a requirement of nagios, or of the UI (apache)?
# install_prereq php "mandatory"
os_install unzip

build_preconditions

./configure --prefix=${prefix} --sysconfdir=${etc_dir}/nagios --with-nagios-user=${service_user} --with-nagios-group=${service_user} | logalize $(configure_log)

standard_install all

# !!!! config creator?
echo "To customize URL, edit both usr/nagios/share/config.inc.php (cgi_base_url), etc/nagios/cgi.cfg (url_html_path) and etc/apache2/service.conf"
echo "@see config/mknagios_cfg"
